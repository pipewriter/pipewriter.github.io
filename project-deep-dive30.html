<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Engine from Scratch │ Graphics Engineer Deep Dive</title>

<!-- ==== EARTH‑TONE THEME ==== -->
<style>
:root{
  --soil-900:#372b23;         /* near–black umber   */
  --soil-700:#524134;         /* deep walnut        */
  --soil-500:#7b614f;         /* roasted chestnut   */
  --clay-300:#b2957c;         /* clay               */
  --sand-200:#d8c5ad;         /* sun‑bleached sand  */
  --sage-accent:#78907c;      /* dusty sage accent */
  --tempo-s: 0.35s;           /* std anim timing    */
  --bezier: cubic-bezier(.25,.8,.35,1);
  color-scheme: dark light; /* allow user prefs */
}
html,body{margin:0;height:100%;scroll-behavior:smooth;font-family:system-ui,sans-serif;background:var(--soil-900);color:var(--sand-200);}
::-moz-selection,*::selection{background:var(--sage-accent);color:var(--soil-900);}
h1,h2,h3{margin:.2em 0;font-weight:600;color:var(--sand-200);}
p{max-width:65ch;line-height:1.6;margin:.4em 0;}
section{padding:5rem 7vw;position:relative;opacity:0;transform:translateY(40px);transition:opacity var(--tempo-s) var(--bezier),transform var(--tempo-s) var(--bezier);}
section.visible{opacity:1;transform:none;}
/* Hero overrides */
#hero{display:grid;place-items:center;min-height:100vh;padding:0;overflow:hidden;background:linear-gradient(160deg,var(--soil-700),var(--soil-900));}
#hero canvas{width:100%;height:100%;display:block;}
#hero h1{position:absolute;text-align:center;mix-blend-mode:overlay;font-size:clamp(2.2rem,6vw,5rem);text-transform:uppercase;letter-spacing:.05em;text-shadow:0 2px 12px #0008;}
/* Section ornaments */
.split{display:grid;gap:clamp(2rem,5vw,4rem);grid-template-columns:repeat(auto-fit,minmax(280px,1fr));align-items:center;}
.card{padding:2rem;border-radius:12px;background:var(--soil-700);box-shadow:0 2px 10px #0004;transition:transform var(--tempo-s) var(--bezier);}
.card:hover{transform:translateY(-6px) scale(1.02);}
.code{font-family:monospace;font-size:.9rem;background:var(--soil-500);padding:.6rem .8rem;border-radius:6px;display:block;white-space:pre-wrap;}
/* Parallax background divs */
.parallax{pointer-events:none;position:absolute;inset:0;background:radial-gradient(circle at 50% 20%,#fff1 0 15%,transparent 60%) var(--soil-900);background-size:120% 120%;transform-origin:center;}
/* Fade‑in keyframes for micro text shimmer */
@keyframes shimmer{0%{background-size:200% 100%;}100%{background-size:0 100%;}}
.shimmer{background:linear-gradient(90deg,var(--sage-accent) 0 25%,transparent 25% 75%,var(--sage-accent) 75% 100%);-webkit-background-clip:text;color:transparent;animation:shimmer 2s linear infinite;}

footer{padding:3rem 7vw;text-align:center;font-size:.85rem;color:var(--clay-300);}
a{color:var(--sage-accent);text-decoration:none;font-weight:500;}
a:hover{text-decoration:underline;}
</style>
</head>
<body>

<!-- ===== HERO / LIVE WEBGL DEMO ===== -->
<header id="hero" aria-label="live shader demo">
  <canvas id="gl"></canvas>
  <h1><span class="shimmer">Engine&nbsp;From&nbsp;Scratch</span></h1>
</header>

<!-- ===== OVERVIEW ===== -->
<section id="overview">
  <div class="split">
    <div>
      <h2>01 · Genesis</h2>
      <p>In 2024 – 2025 I wrote a cross‑platform <strong>rendering engine</strong> from the metal up: memory allocators, hot‑reloadable shaders, job system, and an ECS built for data‑oriented transforms.</p>
      <p>Below I unpack the design decisions, trade‑offs and victories that shaped the project into a 120 FPS, zero‑GC powerhouse.</p>
    </div>
    <div class="card">
<code class="code">// src/core/Boot.cpp
if(!renderer.init(window)){
    panic("GPU refused the handshake");
}
world = make_world(Allocator::Arena(64_MB));
hotReload.watch(&shaders);</code>
    </div>
  </div>
  <div class="parallax" style="background-position:50% 30%;opacity:.08"></div>
</section>

<!-- ===== ARCHITECTURE ===== -->
<section id="arch">
  <h2>02 · Architecture</h2>
  <div class="split">
    <div class="card">
      <h3>Data–Oriented ECS</h3>
      <p>Cache‑coherent archetypes keep transforms contiguous; SIMD frustum culling runs in <em>&lt;0.2 ms</em> for 10k entities on an M2.</p>
    </div>
    <div class="card">
      <h3>Hot‑Swap Shaders</h3>
      <p>File‑watch service pushes edited GLSL to the GPU within <span aria-label="milliseconds">ms</span>, skipping full restarts and carving hours off iteration time.</p>
    </div>
    <div class="card">
      <h3>Custom Memory</h3>
      <p>Arenas + bump allocators means <strong>zero runtime frees</strong> per frame; perf budgets stay deterministic.</p>
    </div>
  </div>
</section>

<!-- ===== TECH DEMOS ===== -->
<section id="demos">
  <h2>03 · Tech Demos</h2>
  <p>Each mini‑demo renders in the hero canvas—use the **buttons** below to switch pipelines.</p>
  <div class="split" style="grid-template-columns:repeat(auto-fit,minmax(120px,1fr));text-align:center">
    <button data-mode="phong" class="card">Phong</button>
    <button data-mode="pbr"   class="card">PBR</button>
    <button data-mode="wire"  class="card">Wireframe</button>
    <button data-mode="normals" class="card">Normals</button>
  </div>
</section>

<!-- ===== PERFORMANCE ===== -->
<section id="perf">
  <h2>04 · Performance + Stats</h2>
  <div class="split">
    <div>
      <p>Benchmarked on an RTX 3070 desktop and M2 Pro laptop:</p>
      <ul>
        <li>10 k draw‑calls → **0.8 ms** command build</li>
        <li>GPU frame time stable at **7.4 ms** (≈135 FPS)</li>
        <li>CPU simulation **2.1 ms** (single thread) → **0.4 ms** (8‑thread job pool)</li>
      </ul>
    </div>
    <div class="card">
<code class="code">Frame Timings (ms)
┌─────────┬──────┐
│ Pass    │ Time │
├─────────┼──────┤
│ G‑Buffer│ 2.3  │
│ Lighting│ 1.6  │
│ PostFX  │ 0.9  │
│ Present │ 0.3  │
└─────────┴──────┘</code>
    </div>
  </div>
</section>

<footer>
  &copy; 2025 Your Name · Built with raw WebGL + caffeine<br>
  <a href="#hero">Back to top ▲</a>
</footer>

<!-- =============  VANILLA JS  ============= -->
<script>
// === Section reveal on scroll ===
const observer=new IntersectionObserver((ents)=>ents.forEach(e=>{
  if(e.isIntersecting) e.target.classList.add('visible');
}),{threshold:.25});
document.querySelectorAll('section').forEach(s=>observer.observe(s));

// === Hero WebGL ===
const canvas=document.getElementById('gl');
const gl=canvas.getContext('webgl');
if(!gl){alert('WebGL unavailable');}
let W,H;const DPR=window.devicePixelRatio||1;
function resize(){W=innerWidth;H=innerHeight;canvas.width=W*DPR;canvas.height=H*DPR;gl.viewport(0,0,W*DPR,H*DPR);}
addEventListener('resize',resize);resize();

// --- Minimal shader boilerplate ---
const vs=`attribute vec3 p;
uniform mat4 mvp;void main(){gl_Position=mvp*vec4(p,1.0);}`;
const fsModes={
  phong:`precision mediump float;
  void main(){vec3 c=vec3(.42,.36,.28);
  float l=dot(normalize(vec3(.7,.3,.5)),vec3(0,0,1));gl_FragColor=vec4(c*(.4+l*.6),1);} `,
  pbr:`precision mediump float;
  void main(){gl_FragColor=vec4(.57,.46,.35,1);}`,
  wire:`precision mediump float;void main(){discard;}`,
  normals:`precision mediump float;
  void main(){gl_FragColor=vec4(0,.8,.6,1);} `
};
let mode='phong';
function compile(src,type){const s=gl.createShader(type);gl.shaderSource(s,src);gl.compileShader(s);return s;}
function program(fs){const p=gl.createProgram();
gl.attachShader(p,compile(vs,gl.VERTEX_SHADER));
gl.attachShader(p,compile(fs,gl.FRAGMENT_SHADER));
gl.linkProgram(p);return p;}
let prog=program(fsModes[mode]);
const loc={mvp:gl.getUniformLocation(prog,'mvp'),p:0};

// --- Cube geometry ---
const verts= new Float32Array([
  -1,-1,-1, 1,-1,-1, 1,1,-1, -1,1,-1,
  -1,-1, 1, 1,-1, 1, 1,1, 1, -1,1, 1]);
const idx= new Uint16Array([
  0,1,2,2,3,0, 4,5,6,6,7,4, 0,4,7,7,3,0,
  1,5,6,6,2,1, 3,2,6,6,7,3, 0,1,5,5,4,0]);
gl.bindBuffer(gl.ARRAY_BUFFER,gl.createBuffer());
gl.bufferData(gl.ARRAY_BUFFER,verts,gl.STATIC_DRAW);
gl.vertexAttribPointer(loc.p,3,gl.FLOAT,false,0,0);
gl.enableVertexAttribArray(loc.p);
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,gl.createBuffer());
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,idx,gl.STATIC_DRAW);

function mat4persp(fov,asp,n,f){const t=Math.tan(fov/2);return[
  1/(t*asp),0,0,0, 0,1/t,0,0, 0,0,(f+n)/(n-f),-1,
  0,0,2*f*n/(n-f),0];}
function mat4rotY(a){return[Math.cos(a),0,Math.sin(a),0, 0,1,0,0, -Math.sin(a),0,Math.cos(a),0, 0,0,0,1];}
function mul(a,b){const o=new Float32Array(16);
for(let i=0;i<4;i++)for(let j=0;j<4;j++)o[i*4+j]=a[i*4]*b[j]+a[i*4+1]*b[j+4]+a[i*4+2]*b[j+8]+a[i*4+3]*b[j+12];
return o;}

let t=0;
function render(time){
  t=time*.0005;
  gl.clearColor(0,0,0,1);gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);
  gl.enable(gl.DEPTH_TEST);
  gl.useProgram(prog);
  const P=mat4persp(1.1,W/H,0.1,50);
  const V=[1,0,0,0, 0,1,0,0, 0,0,1,0, 0,0,-5,1];
  const M=mat4rotY(t);
  gl.uniformMatrix4fv(loc.mvp,false,mul(P,mul(V,M)));
  gl.drawElements(gl.TRIANGLES,idx.length,gl.UNSIGNED_SHORT,0);
  requestAnimationFrame(render);
}
requestAnimationFrame(render);

// === Mode switch buttons ===
document.querySelectorAll('button[data-mode]').forEach(b=>b.onclick=()=>{
  mode=b.dataset.mode;
  prog=program(fsModes[mode]);
  loc.mvp=gl.getUniformLocation(prog,'mvp');
});
</script>
</body>
</html>
