<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Page Flipper (+ synced URL)</title>
<style>
/* ---------- layout (unchanged) ---------- */
html,body{height:100%;margin:0;font-family:system-ui,sans-serif;display:flex;flex-direction:column}
#controls{padding:.5rem;display:flex;gap:.5rem;background:#f5f5f5;box-shadow:0 1px 2px rgba(0,0,0,.1)}
#controls button{flex:1 1 0;padding:.75rem 1rem;font-size:1rem;cursor:pointer}
#viewer{flex:1 1 auto;width:100%;border:none}
</style>
</head>
<body>

<div id="controls">
  <button id="prev">◀ Previous</button>
  <button id="next">Next ▶</button>
</div>

<iframe id="viewer" src="/webxr-minecraft0.html"></iframe>

<script>
const PARAM = 'page';               // name of the GET parameter

// === helpers ===============================================================
function digitsBeforeHtml(path){          // -> number found or NaN
  const m = path.match(/(\d+)(?=\.html$)/);
  return m ? Number(m[1]) : NaN;
}

function updateFrameTo(page){
  const frame = document.getElementById('viewer');
  const url   = new URL(frame.src, location.href);
  url.pathname = url.pathname.replace(/(\d+)(?=\.html$)/, String(page));
  frame.src    = url;                       // navigates the iframe
}

function updateQueryParam(page, push){      // push == true -> add history
  const url = new URL(location.href);
  url.searchParams.set(PARAM, page);
  (push ? history.pushState : history.replaceState)({page}, '', url);
}

// One single “goto” that both buttons and history events can call. ---------
function gotoPage(page, push=true){
  if(page < 0 || isNaN(page)) return;        // simple guard
  updateFrameTo(page);
//   updateQueryParam(page, push);
    const params = new URLSearchParams(window.location.search);
  params.set('page', page);
  console.log(page)
  window.history.replaceState(null,'', '?' + params.toString());

}

// === buttons ===============================================================
document.getElementById('prev').addEventListener('click', ()=>{
  const cur = digitsBeforeHtml(document.getElementById('viewer').src);
  gotoPage(cur-1);
});
document.getElementById('next').addEventListener('click', ()=>{
  const cur = digitsBeforeHtml(document.getElementById('viewer').src);
  gotoPage(cur+1);
});

// === initial load ==========================================================
window.addEventListener('DOMContentLoaded', ()=>{
  const params = new URLSearchParams(location.search);
  const qPage  = Number(params.get(PARAM));

  if(!isNaN(qPage)){             // ?page=… was supplied → honour it
    gotoPage(qPage, false);      // false = replace, don’t create history entry
  }else{                         // no param → derive from initial src & expose it
    const initial = digitsBeforeHtml(document.getElementById('viewer').src);
    if(!isNaN(initial)) updateQueryParam(initial, false);
  }
});

// === back / forward buttons ===============================================
window.addEventListener('popstate', (e)=>{
  const page = e.state && typeof e.state.page === 'number'
             ? e.state.page
             : Number(new URLSearchParams(location.search).get(PARAM));
  gotoPage(page, false);          // do NOT push another entry while replaying

});
</script>
</body>
</html>
