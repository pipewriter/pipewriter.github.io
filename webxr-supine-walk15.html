
<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Supine Walking Simulator XR</title><style>body{margin:0;overflow:hidden}</style></head><body></body><script type="module">import*as THREE from"https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js";import{VRButton}from"https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/webxr/VRButton.js";const scene=new THREE.Scene();scene.background=new THREE.Color(0x88ccee);const camera=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,0.1,1e3);const renderer=new THREE.WebGLRenderer({antialias:true});renderer.setSize(innerWidth,innerHeight);renderer.xr.enabled=true;document.body.appendChild(renderer.domElement);document.body.appendChild(VRButton.createButton(renderer));const rig=new THREE.Group();rig.add(camera);scene.add(rig);scene.add(new THREE.HemisphereLight(0xffffff,0x444444,1));const g=new THREE.PlaneGeometry(200,200,10,10);g.rotateX(-Math.PI/2);scene.add(new THREE.Mesh(g,new THREE.MeshStandardMaterial({color:0x228822})));for(let i=0;i<200;i++){const b=new THREE.Mesh(new THREE.BoxGeometry(1,1,1),new THREE.MeshStandardMaterial({color:Math.random()*0xffffff}));b.position.set((Math.random()-.5)*100,.5,(Math.random()-.5)*100);scene.add(b);}let leftLock=false;const ctrls=[];function setup(i){const c=renderer.xr.getController(i);c.addEventListener("connected",()=>ctrls[i]=c);scene.add(c);}setup(0);setup(1);function gp(hand){for(const c of ctrls)if(c?.inputSource?.handedness===hand)return c.inputSource.gamepad;return null;}const clk=new THREE.Clock();renderer.setAnimationLoop(()=>{const dt=clk.getDelta(),spd=3,ang=Math.PI/6,right=gp("right");if(right){const a=right.axes,vy=a[3]||0,vx=a[2]||0,t=.2;if(Math.abs(vy)>t||Math.abs(vx)>t){const q=renderer.xr.getCamera(camera).quaternion,f=new THREE.Vector3(0,1,0).applyQuaternion(q).normalize(),r=new THREE.Vector3(1,0,0).applyQuaternion(q).normalize();rig.position.addScaledVector(f,-vy*spd*dt);rig.position.addScaledVector(r,vx*spd*dt);}}const left=gp("left");if(left){const hx=left.axes[2]||0;if(!leftLock&&(hx>.8||hx<-.8)){rig.rotation.y+=hx>0?-ang:ang;leftLock=true;}else if(Math.abs(hx)<.3)leftLock=false;}renderer.render(scene,camera);});addEventListener("resize",()=>{camera.aspect=innerWidth/innerHeight;camera.updateProjectionMatrix();renderer.setSize(innerWidth,innerHeight);});</script></html>
