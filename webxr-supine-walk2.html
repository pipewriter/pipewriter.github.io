
<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Supine Walking Simulator</title><style>*{margin:0;padding:0}canvas{display:block}</style></head><body><script type="module">import*as THREE from"https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.module.js";import{VRButton}from"https://cdn.jsdelivr.net/npm/three@0.161.0/examples/jsm/webxr/VRButton.js";let scene=new THREE.Scene();scene.background=new THREE.Color(0x88ccee);let camera=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,.1,1e3);let renderer=new THREE.WebGLRenderer({antialias:!0});renderer.setPixelRatio(devicePixelRatio);renderer.setSize(innerWidth,innerHeight);renderer.xr.enabled=!0;document.body.appendChild(renderer.domElement);document.body.appendChild(VRButton.createButton(renderer));let player=new THREE.Group();player.add(camera);scene.add(player);let light=new THREE.HemisphereLight(16777215,4473924,1);light.position.set(0,1,0);scene.add(light);let g=new THREE.PlaneGeometry(200,200,32,32);g.rotateX(-Math.PI/2);for(let i=0;i<g.attributes.position.count;i++){let x=g.attributes.position.getX(i),z=g.attributes.position.getZ(i);g.attributes.position.setY(i,Math.sin(.1*x)*Math.cos(.1*z)*2)}g.computeVertexNormals();scene.add(new THREE.Mesh(g,new THREE.MeshStandardMaterial({color:0x228822})));for(let i=0;i<200;i++){let geo=i&1?new THREE.BoxGeometry(1,1,1):new THREE.SphereGeometry(.5,16,16);let mat=new THREE.MeshStandardMaterial({color:new THREE.Color(Math.random(),Math.random(),Math.random())});let m=new THREE.Mesh(geo,mat);m.position.set((Math.random()-.5)*180,1,(Math.random()-.5)*180);scene.add(m)}let controllers=[],rightAxes=[0,0],leftAxes=[0,0],turnCD=0,clock=new THREE.Clock;function connect(src){controllers.push(src)}renderer.xr.addEventListener("sessionstart",()=>{let s=renderer.xr.getSession();s.inputSources.forEach(i=>i.gamepad&&connect(i));s.addEventListener("inputsourceschange",()=>{controllers.length=0;s.inputSources.forEach(i=>i.gamepad&&connect(i))})});function update(dt){rightAxes=[0,0];leftAxes=[0,0];controllers.forEach(c=>{let a=c.gamepad.axes;if(a.length<2)return;("right"===c.handedness?(rightAxes=[a[2]??0,a[3]??0]):(leftAxes=[a[0],a[1]]))});let move=rightAxes[1];if(Math.abs(move)>.2){let up=new THREE.Vector3().copy(camera.up).transformDirection(camera.matrixWorld);player.position.addScaledVector(up,-move*5*dt)}if(turnCD>0)turnCD-=dt;let turn=leftAxes[0];if(Math.abs(turn)>.6&&turnCD<=0){player.rotation.y+=Math.sign(turn)*Math.PI/6;turnCD=.3}}function onResize(){camera.aspect=innerWidth/innerHeight;camera.updateProjectionMatrix();renderer.setSize(innerWidth,innerHeight)}addEventListener("resize",onResize);renderer.setAnimationLoop(()=>{let dt=clock.getDelta();update(dt);renderer.render(scene,camera)})</script></body></html>
