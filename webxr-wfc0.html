<html><head><meta charset="utf-8"/><title>WebXR WFC</title><style>body{margin:0;overflow:hidden}</style></head><body><script type="module">import * as THREE from "https://unpkg.com/three@0.163.0/build/three.module.js";import{VRButton}from "https://unpkg.com/three@0.163.0/examples/jsm/webxr/VRButton.js";const size=20,types=7,grid=Array(size*size).fill(0).map(()=>({c:[0,1,2,3,4,5,6]})),idx=(x,y)=>y*size+x,neighbors=(x,y)=>[[x-1,y],[x+1,y],[x,y-1],[x,y+1]].filter(p=>p[0]>=0&&p[0]<size&&p[1]>=0&&p[1]<size);function collapse(){for(;;){let m=8,c=-1;for(let i=0;i<grid.length;i++){let d=grid[i].c;if(d.length>1&&d.length<m){m=d.length;c=i}}if(c==-1)break;let opts=grid[c].c,choice=opts[Math.random()*opts.length|0];grid[c].c=[choice];let stack=[c];while(stack.length){let cur=stack.pop(),x=cur%size,y=cur/size|0;neighbors(x,y).forEach(n=>{let ni=idx(n[0],n[1]),nc=grid[ni].c;if(nc.length>1){let b=nc.length;grid[ni].c=nc.filter(t=>t!=grid[cur].c[0]);if(!grid[ni].c.length)grid[ni].c=[Math.random()*types|0];if(grid[ni].c.length!=b)stack.push(ni)}})}}}collapse();const scene=new THREE.Scene();scene.background=new THREE.Color(0x222222);const camera=new THREE.PerspectiveCamera(70,innerWidth/innerHeight,.1,100);camera.position.set(0,20,0);camera.lookAt(0,0,0);const renderer=new THREE.WebGLRenderer({antialias:true});renderer.setSize(innerWidth,innerHeight);renderer.xr.enabled=true;document.body.appendChild(renderer.domElement);document.body.appendChild(VRButton.createButton(renderer));const light=new THREE.DirectionalLight(0xffffff,1);light.position.set(1,1,1);scene.add(light);scene.add(new THREE.AmbientLight(0xffffff,.4));function make(t){switch(t){case 0:return new THREE.Mesh(new THREE.BoxGeometry(.9,.2,.9),new THREE.MeshStandardMaterial({color:0xff0000}));case 1:return new THREE.Mesh(new THREE.ConeGeometry(.45,.5,16),new THREE.MeshStandardMaterial({color:0x00ff00}));case 2:return new THREE.Mesh(new THREE.SphereGeometry(.45,16,16),new THREE.MeshStandardMaterial({color:0x0000ff}));case 3:return new THREE.Mesh(new THREE.TorusKnotGeometry(.3,.1,64,8),new THREE.MeshStandardMaterial({color:0xffff00}));case 4:return new THREE.Mesh(new THREE.CylinderGeometry(.4,.4,.5,16),new THREE.MeshStandardMaterial({color:0xff00ff}));case 5:return new THREE.Mesh(new THREE.DodecahedronGeometry(.45),new THREE.MeshStandardMaterial({color:0x00ffff}));default:return new THREE.Mesh(new THREE.OctahedronGeometry(.45),new THREE.MeshStandardMaterial({color:0xffffff}))}}for(let y=0;y<size;y++)for(let x=0;x<size;x++){let m=make(grid[idx(x,y)].c[0]);m.position.set(x-size/2,0,y-size/2);scene.add(m)}const plane=new THREE.Mesh(new THREE.PlaneGeometry(size,size),new THREE.MeshStandardMaterial({color:0x101010,side:THREE.DoubleSide}));plane.rotation.x=-Math.PI/2;scene.add(plane);addEventListener("resize",()=>{camera.aspect=innerWidth/innerHeight;camera.updateProjectionMatrix();renderer.setSize(innerWidth,innerHeight)});renderer.setAnimationLoop(()=>renderer.render(scene,camera));</script></body></html>