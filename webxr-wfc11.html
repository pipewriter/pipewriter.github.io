<html><head><meta charset="utf-8"><title>WFC WebXR</title><style>body{margin:0;overflow:hidden;background:#000}</style></head><body><script type="module">import*as T from"https://unpkg.com/three@0.161.0/build/three.module.js";import{VRButton as V}from"https://unpkg.com/three@0.161.0/examples/jsm/webxr/VRButton.js";import{XRControllerModelFactory as F}from"https://unpkg.com/three@0.161.0/examples/jsm/webxr/XRControllerModelFactory.js";const S=40,H=10,eye=1.6,colors=[0x1abc9c,0x2ecc71,0x3498db,0x9b59b6,0xf1c40f,0xe67e22,0xe74c3c,0xecf0f1,0x95a5a6,0x7f8c8d];function wfc(s,st){function n(x,y){return[[x-1,y],[x+1,y],[x,y-1],[x,y+1]].filter(([a,b])=>a>=0&&a<s&&b>=0&&b<s)}function gen(){let o=Array.from({length:s},()=>Array.from({length:s},()=>Array.from({length:st},(_,i)=>i)));for(;;){let m=st+1,c=[];for(let y=0;y<s;y++)for(let x=0;x<s;x++){let p=o[y][x];p.length>1&&p.length<m?(m=p.length,c=[[x,y]]):p.length===m&&c.push([x,y])}if(!c.length)break;let[r,u]=c[Math.random()*c.length|0],l=o[u][r],e=l[Math.random()*l.length|0];o[u][r]=[e];let q=[[r,u]];for(;q.length;){let[a,b]=q.pop(),v=o[b][a][0];for(let[d,f]of n(a,b)){let w=o[f][d];if(w.length>1){let k=w.length;o[f][d]=w.filter(z=>z!==v);if(!o[f][d].length)return null;o[f][d].length<k&&q.push([d,f])}}}}return o.map(y=>y.map(z=>z[0]))}let m=null;for(;!m;)m=gen();return m}const heights=wfc(S,H),shapeIds=wfc(S,6),shapes=["none","box","cone","cyl","sphere","torus"],scene=new T.Scene(),renderer=new T.WebGLRenderer({antialias:1});renderer.setSize(innerWidth,innerHeight);renderer.xr.enabled=1;document.body.append(renderer.domElement);document.body.append(V.createButton(renderer));const camera=new T.PerspectiveCamera(70,innerWidth/innerHeight,.1,1e3),user=new T.Group();user.add(camera);scene.add(user);user.position.set(S/2,eye+heights[S>>1][S>>1],S/2);const light=new T.DirectionalLight(0xffffff,1);light.position.set(1,2,3);scene.add(light);const gBox=new T.BoxGeometry(1,1,1),gCone=new T.ConeGeometry(.5,1,8),gCyl=new T.CylinderGeometry(.5,.5,1,8),gSphere=new T.SphereGeometry(.5,16,12),gTorus=new T.TorusGeometry(.35,.15,8,16);for(let z=0;z<S;z++)for(let x=0;x<S;x++){let h=heights[z][x],bh=h+1,mat=new T.MeshLambertMaterial({color:colors[h%colors.length]}),cube=new T.Mesh(gBox,mat);cube.scale.y=bh;cube.position.set(x,bh/2,z);scene.add(cube);let sid=shapeIds[z][x],shape=shapes[sid];if(shape!=="none"){let geo={box:gBox,cone:gCone,cyl:gCyl,sphere:gSphere,torus:gTorus}[shape],mat2=new T.MeshLambertMaterial({color:colors[(h+sid)%colors.length]}),obj=new T.Mesh(geo,mat2);obj.scale.set(.6,.6,.6);obj.position.set(x,bh+.3,z);scene.add(obj)}}const factory=new F(),ctrl0=renderer.xr.getController(0),ctrl1=renderer.xr.getController(1),grip0=renderer.xr.getControllerGrip(0),grip1=renderer.xr.getControllerGrip(1);grip0.add(factory.createControllerModel(grip0));grip1.add(factory.createControllerModel(grip1));scene.add(ctrl0,ctrl1,grip0,grip1);let prevLX=0;const clock=new T.Clock();addEventListener("resize",()=>{camera.aspect=innerWidth/innerHeight;camera.updateProjectionMatrix();renderer.setSize(innerWidth,innerHeight)});function animate(){let dt=clock.getDelta(),session=renderer.xr.getSession();if(session){for(let src of session.inputSources){if(!src.gamepad)continue;let h=src.handedness,ax=src.gamepad.axes;if(h==="right"){let sx=ax[0]||0,sy=ax[1]||0;if(Math.abs(sx)+Math.abs(sy)>.1){const dir=new T.Vector3();camera.getWorldDirection(dir);dir.y=0;dir.normalize();const right=new T.Vector3().crossVectors(dir,new T.Vector3(0,1,0)).normalize();user.position.addScaledVector(dir,-sy*3*dt);user.position.addScaledVector(right,sx*3*dt)}}else if(h==="left"){let lx=ax[0]||0;if(lx>0.8&&prevLX<=0.8)user.rotation.y-=Math.PI/4;else if(lx<-0.8&&prevLX>=-0.8)user.rotation.y+=Math.PI/4;prevLX=lx}}let gx=Math.round(user.position.x),gz=Math.round(user.position.z);if(gx>=0&&gx<S&&gz>=0&&gz<S)user.position.y=heights[gz][gx]+eye}renderer.render(scene,camera);requestAnimationFrame(animate)}animate();</script></body></html>