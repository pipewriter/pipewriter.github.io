
<!DOCTYPE html><html><head><meta charset="utf-8"><title>WFC XR</title><style>body{margin:0;overflow:hidden}</style></head><body><script type="module">import*as T from'https://unpkg.com/three@0.157.0/build/three.module.js';import{VRButton}from'https://unpkg.com/three@0.157.0/examples/jsm/webxr/VRButton.js';const r=new T.WebGLRenderer({antialias:!0});r.setSize(innerWidth,innerHeight);r.xr.enabled=!0;document.body.appendChild(r.domElement);document.body.appendChild(VRButton.createButton(r));const s=new T.Scene,c=new T.PerspectiveCamera(70,innerWidth/innerHeight,.1,1e3),u=new T.Group;u.add(c);s.add(u);const l=new T.HemisphereLight(16777215,4473924,1);l.position.set(0,1,0);s.add(l);const G=20,TZ=1.5,HN=4,ON=5,HC=[0x2e8b57,0x3cb371,0x6b8e23,0x8fbc8f],OC=[16711680,65280,255,16776960],ne=(x,y)=>[[x+1,y],[x-1,y],[x,y+1],[x,y-1]].filter(p=>p[0]>=0&&p[0]<G&&p[1]>=0&&p[1]<G),wf=(n,a)=>{let p=Array.from({length:G},()=>Array.from({length:G},()=>Array.from({length:n},(_,i)=>i))),g=0;for(;;){if(g++>G*G*10)break;let m=n+1,ch=[];for(let y=0;y<G;y++)for(let x=0;x<G;x++){let l=p[y][x].length;l>1&&l<m?(m=l,ch=[[x,y]]):l===m&&ch.push([x,y])}if(m===n+1)break;const[px,py]=ch[Math.random()*ch.length|0],opts=p[py][px];p[py][px]=[opts[Math.random()*opts.length|0]];const q=[[px,py]];for(;q.length;){const[qx,qy]=q.shift(),t=p[qy][qx][0];for(const[nx,ny]of ne(qx,qy)){let poss=p[ny][nx];if(poss.length>1){poss=poss.filter(v=>a(t).includes(v)),poss.length||(poss=[Math.random()*n|0]),poss.length!==p[ny][nx].length&&(p[ny][nx]=poss,q.push([nx,ny]))}}}}return p.map(r=>r.map(c=>c[0]))},hA=t=>[Math.max(0,t-1),t,Math.min(HN-1,t+1)],oA=t=>[t,(t+1)%ON,(t+ON-1)%ON],hG=wf(HN,hA),oG=wf(ON,oA),grounds=[],og=[null,new T.BoxGeometry(.5,.5,.5),new T.SphereGeometry(.25,16,16),new T.ConeGeometry(.3,.6,8),new T.CylinderGeometry(.25,.25,.6,8)];for(let y=0;y<G;y++)for(let x=0;x<G;x++){const hIdx=hG[y][x],tH=.2+.6*hIdx,g=new T.BoxGeometry(TZ,tH,TZ),m=new T.MeshStandardMaterial({color:HC[hIdx]}),mesh=new T.Mesh(g,m);mesh.position.set((x-G/2)*TZ,tH/2,(y-G/2)*TZ);s.add(mesh);grounds.push(mesh);const oIdx=oG[y][x];if(oIdx){const geom=og[oIdx].clone(),mat=new T.MeshStandardMaterial({color:OC[oIdx-1]}),om=new T.Mesh(geom,mat);geom.computeBoundingBox();const oh=geom.boundingBox.max.y-geom.boundingBox.min.y;om.position.set(mesh.position.x,tH+oh/2,mesh.position.z);s.add(om)}}const ray=new T.Raycaster,down=new T.Vector3(0,-1,0);let snap=0;r.setAnimationLoop(t=>{const ses=r.xr.getSession();if(ses)for(const src of ses.inputSources)if(src.gamepad){const a=src.gamepad.axes,hand=src.handedness,xA=a[2]??a[0]??0,yA=a[3]??a[1]??0;if(hand==='right'){const sp=.05,dir=new T.Vector3;c.getWorldDirection(dir);dir.y=0;dir.normalize();const str=new T.Vector3().crossVectors(new T.Vector3(0,1,0),dir).normalize();u.position.addScaledVector(dir,-yA*sp);u.position.addScaledVector(str,xA*sp)}else if(hand==='left'&&Math.abs(xA)>.7&&t>snap){u.rotation.y+=Math.sign(-xA)*Math.PI/4;snap=t+300}}ray.set(new T.Vector3(u.position.x,50,u.position.z),down);const hit=ray.intersectObjects(grounds,!1)[0];hit&&(u.position.y=hit.point.y+1.6);r.render(s,c)});</script></body></html>
