
<!DOCTYPE html><html><head><meta charset="utf-8"><title>WFC XR</title><style>body{margin:0;overflow:hidden}</style></head><body><script type="module">import*as THREE from'https://unpkg.com/three@0.157.0/build/three.module.js';import{VRButton}from'https://unpkg.com/three@0.157.0/examples/jsm/webxr/VRButton.js';const scene=new THREE.Scene(),renderer=new THREE.WebGLRenderer({antialias:!0});renderer.setSize(innerWidth,innerHeight);renderer.xr.enabled=!0;document.body.append(renderer.domElement,VRButton.createButton(renderer));const camera=new THREE.PerspectiveCamera(70,innerWidth/innerHeight,.1,1e3),player=new THREE.Group();player.add(camera);scene.add(player);scene.add(new THREE.HemisphereLight(16777215,4473924,.6));const dl=new THREE.DirectionalLight(16777215,.8);dl.position.set(5,10,2);scene.add(dl);const gridSize=30,tileSize=1.5,levels=7,colors=[16711680,65280,255,16776960,16711935,65535,16777215],groundTiles=[],heights=[];for(let i=0;i<levels;i++){groundTiles.push(new THREE.Mesh(new THREE.BoxGeometry(tileSize,.2*tileSize,tileSize),new THREE.MeshStandardMaterial({color:colors[i]})))}const gPoss=[];for(let y=0;y<gridSize;y++){gPoss[y]=[],heights[y]=[];for(let x=0;x<gridSize;x++)gPoss[y][x]=[0,1,2,3,4,5,6]}const nb=(x,y)=>[[x+1,y],[x-1,y],[x,y+1],[x,y-1]].filter(p=>p[0]>=0&&p[0]<gridSize&&p[1]>=0&&p[1]<gridSize),allow=t=>[t,(t+1)%levels,(t+levels-1)%levels],collapse=p=>{let u=!0,g=0;for(;u&&g<gridSize*gridSize*10;){g++;let m=99,c=[];for(let y=0;y<gridSize;y++)for(let x=0;x<gridSize;x++){const l=p[y][x].length;l>1&&l<m?(m=l,c=[[x,y]]):l===m&&c.push([x,y])}if(m===99){u=!1;break}const[oX,oY]=c[Math.random()*c.length|0],opts=p[oY][oX],pick=opts[Math.random()*opts.length|0];p[oY][oX]=[pick];const q=[[oX,oY]];for(;q.length;){const[qx,qy]=q.shift(),t=p[qy][qx][0];for(const[nx,ny]of nb(qx,qy)){let poss=p[ny][nx];if(poss.length>1){const a=allow(t);poss=poss.filter(v=>a.includes(v));poss.length|| (poss=[Math.random()*levels|0]);poss.length!==p[ny][nx].length&&(p[ny][nx]=poss,q.push([nx,ny]))}}}}};collapse(gPoss);for(let y=0;y<gridSize;y++)for(let x=0;x<gridSize;x++){const t=gPoss[y][x][0];heights[y][x]=t;const h=.2*tileSize*(t+1),mesh=groundTiles[t].clone();mesh.scale.y=h/(.2*tileSize);mesh.position.set((x-gridSize/2)*tileSize,h/2,(y-gridSize/2)*tileSize);scene.add(mesh)}const objShapes=[null,new THREE.Mesh(new THREE.BoxGeometry(.6,.6,.6),new THREE.MeshStandardMaterial({color:16744192})),new THREE.Mesh(new THREE.SphereGeometry(.35,16,16),new THREE.MeshStandardMaterial({color:3407667})),new THREE.Mesh(new THREE.ConeGeometry(.35,.8,16),new THREE.MeshStandardMaterial({color:13434879})),new THREE.Mesh(new THREE.CylinderGeometry(.35,.35,.8,16),new THREE.MeshStandardMaterial({color:6697727}))],oPoss=[];for(let y=0;y<gridSize;y++){oPoss[y]=[];for(let x=0;x<gridSize;x++)oPoss[y][x]=[0,0,0,1,2,3,4]}collapse(oPoss);for(let y=0;y<gridSize;y++)for(let x=0;x<gridSize;x++){const o=oPoss[y][x][0];if(o){const m=objShapes[o].clone(),h=.2*tileSize*(heights[y][x]+1);m.position.set((x-gridSize/2)*tileSize,h+.4,(y-gridSize/2)*tileSize);scene.add(m)}}const clock=new THREE.Clock();let snap=!1;renderer.setAnimationLoop(()=>{const dt=clock.getDelta(),sess=renderer.xr.getSession();if(sess){for(const src of sess.inputSources){if(!src.gamepad)continue;const a=src.gamepad.axes,hand=src.handedness;if(hand==="right"){const mx=a[2]||0,my=a[3]||0;if(Math.abs(mx)+Math.abs(my)>.2){const dir=new THREE.Vector3();camera.getWorldDirection(dir);dir.y=0;dir.normalize();const right=new THREE.Vector3().crossVectors(dir,new THREE.Vector3(0,1,0)).normalize();player.position.addScaledVector(dir,-my*dt*3);player.position.addScaledVector(right,mx*dt*3)}}else if(hand==="left"){const lx=a[0]||0;if(Math.abs(lx)>.8&&!snap){player.rotation.y-=Math.sign(lx)*Math.PI/6;snap=!0}else Math.abs(lx)<.2&&(snap=!1)}}const gx=Math.floor(player.position.x/tileSize+gridSize/2),gz=Math.floor(player.position.z/tileSize+gridSize/2);if(gx>=0&&gx<gridSize&&gz>=0&&gz<gridSize){const gH=.2*tileSize*(heights[gz][gx]+1);camera.position.y=gH+1.6}}renderer.render(scene,camera)});</script></body></html>
