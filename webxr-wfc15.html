<html><head><meta charset="utf-8"><title>WFC WebXR</title><style>body{margin:0;overflow:hidden}</style></head><body><script type="module">import*as THREE from"https://cdnjs.cloudflare.com/ajax/libs/three.js/0.161.0/three.module.min.js";import{VRButton}from"https://cdn.jsdelivr.net/npm/three@0.161/examples/jsm/webxr/VRButton.js";const S=50,H=4,O=6,colors=[16732318,4128766,4095,16777022,16732351,4129023,16777215];function wfc(e,t){const n=[...Array(e)].map(()=>[...Array(e)].map(()=>[...Array(t).keys()])),r=(n,r)=>[[n-1,r],[n+1,r],[n,r-1],[n,r+1]].filter(([t,n])=>t>=0&&t<e&&n>=0&&n<e);for(;;){let o=t+1,a=[];for(let r=0;r<e;r++)for(let t=0;t<e;t++){const e=n[r][t];e.length>1&&(e.length<o?(o=e.length,a=[[t,r]]):e.length===o&&a.push([t,r]))}if(!a.length)break;const[o,i]=a[Math.random()*a.length|0],l=n[i][o][Math.random()*n[i][o].length|0];n[i][o]=[l];const c=[[o,i]];for(;c.length;){const[o,i]=c.pop(),a=n[i][o][0];for(const[t,i]of r(o,i))if(n[i][t].length>1){const r=n[i][t].length;if(n[i][t]=n[i][t].filter(e=>e!==a),!n[i][t].length)return null;n[i][t].length<r&&c.push([t,i])}}}return n.map(e=>e.map(e=>e[0]))}let heightMap,objMap;for(;!(heightMap=wfc(S,H)););for(;!(objMap=wfc(S,O)););const renderer=new THREE.WebGLRenderer({antialias:!0});renderer.setSize(innerWidth,innerHeight),renderer.xr.enabled=!0,document.body.appendChild(renderer.domElement),document.body.appendChild(VRButton.createButton(renderer));const scene=new THREE.Scene,light=new THREE.HemisphereLight(16777215,4473924,1);scene.add(light);const player=new THREE.Group;scene.add(player);const camera=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,.1,1e3);camera.position.y=1.6,player.add(camera);const boxGeo=new THREE.BoxGeometry(1,1,1),objs=[null,new THREE.BoxGeometry(.4,.4,.4),new THREE.SphereGeometry(.25,16,16),new THREE.ConeGeometry(.3,.6,8),new THREE.CylinderGeometry(.25,.25,.6,12),new THREE.TorusGeometry(.25,.1,8,16)];for(let z=0;z<S;z++)for(let x=0;x<S;x++){const h=heightMap[z][x],g=new THREE.Mesh(boxGeo,new THREE.MeshLambertMaterial({color:colors[h]}));g.scale.y=h+1,g.position.set(x,h/2,z),scene.add(g);const o=objMap[z][x];if(o){const e=new THREE.Mesh(objs[o].clone(),new THREE.MeshLambertMaterial({color:colors[o]}));e.position.set(x,g.scale.y+.3,z),scene.add(e)}}addEventListener("resize",(()=>{camera.aspect=innerWidth/innerHeight,camera.updateProjectionMatrix(),renderer.setSize(innerWidth,innerHeight)}));const moveSpeed=.08,turnAngle=Math.PI/6,dead=.8,eye=1.6,snapState={left:0};renderer.setAnimationLoop((()=>{const e=renderer.xr.getSession();if(e){for(const t of e.inputSources)if(t.gamepad){const n=t.gamepad.axes,r=t.handedness,o=null!=n[2]?n[2]:n[0],a=null!=n[3]?n[3]:n[1];if("right"===r){const e=new THREE.Vector3;camera.getWorldDirection(e);const t=new THREE.Vector3().crossVectors(e,new THREE.Vector3(0,1,0)).setY(0).normalize(),n=new THREE.Vector3(e.x,0,e.z).normalize();player.position.addScaledVector(n,-a*moveSpeed),player.position.addScaledVector(t,o*moveSpeed)}else if("left"===r){const e=performance.now();o>dead&&e-snapState.left>300?(player.rotation.y-=turnAngle,snapState.left=e):o<-dead&&e-snapState.left>300&&(player.rotation.y+=turnAngle,snapState.left=e)}}const t=player.position.x,n=player.position.z,r=Math.floor(t+.5),o=Math.floor(n+.5);r>=0&&r<S&&o>=0&&o<S&&(player.position.y=heightMap[o][r]+eye)}renderer.render(scene,camera)}));</script></body></html>