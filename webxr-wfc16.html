<html><head><meta charset="utf-8"><title>WFC WebXR</title><style>body{margin:0;overflow:hidden}</style></head><body><script type="module">import*as T from"https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.module.js";import{VRButton as V}from"https://cdn.jsdelivr.net/npm/three@0.161.0/examples/jsm/webxr/VRButton.js";const S=40,ph=1.6,speed=.06,snap=Math.PI/4,hc=[0x567d46,0x7fbf7f,0xc4df9b,0xf3e9b6,0xffffff],oc=[0xff5555,0x55ff55,0x5555ff,0xffff55];function wfc(n,vals,rule){for(;;){let a=Array.from({length:n},()=>Array.from({length:n},()=>vals.slice())),nbs=(x,y)=>[[x-1,y],[x+1,y],[x,y-1],[x,y+1]].filter(([i,j])=>i>=0&&i<n&&j>=0&&j<n);for(;;){let min=vals.length+1,cands=[];for(let y=0;y<n;y++)for(let x=0;x<n;x++){let p=a[y][x];p.length>1&&p.length<min?(min=p.length,cands=[[x,y]]):p.length===min&&cands.push([x,y])}if(!cands.length)break;let[px,py]=cands[Math.random()*cands.length|0],val=a[py][px][Math.random()*a[py][px].length|0];a[py][px]=[val];let q=[[px,py]];for(;q.length;){let[x,y]=q.pop(),v=a[y][x][0];for(let[xx,yy]of nbs(x,y)){let b=a[yy][xx];if(b.length>1){let old=b.length;a[yy][xx]=b.filter(k=>rule(k,v));a[yy][xx].length&&a[yy][xx].length<old&&q.push([xx,yy])}}}}if(a.every(r=>r.every(c=>c.length===1)))return a.map(r=>r.map(c=>c[0]))}}const hmap=wfc(S,[0,1,2,3,4],(a,b)=>Math.abs(a-b)<=1),omap=wfc(S,[0,1,2,3,4],(a,b)=>a===0||a!==b);const scene=new T.Scene(),renderer=new T.WebGLRenderer({antialias:1});renderer.setSize(innerWidth,innerHeight);renderer.xr.enabled=1;document.body.appendChild(renderer.domElement);document.body.appendChild(V.createButton(renderer));const rig=new T.Group();scene.add(rig);const cam=new T.PerspectiveCamera(70,innerWidth/innerHeight,.1,1e3);cam.position.set(0,ph,0);rig.add(cam);scene.add(new T.HemisphereLight(0xffffff,0x444444,1));const box=new T.BoxGeometry(1,1,1),sphere=new T.SphereGeometry(.5,16,12),cone=new T.ConeGeometry(.5,1,8),cyl=new T.CylinderGeometry(.5,.5,1,8);for(let z=0;z<S;z++)for(let x=0;x<S;x++){let h=hmap[z][x],m=new T.Mesh(box,new T.MeshLambertMaterial({color:hc[h]}));m.scale.y=h+1;m.position.set(x,(h+1)/2,z);scene.add(m);let o=omap[z][x];if(o){let g=[box,sphere,cone,cyl][o-1],mesh=new T.Mesh(g,new T.MeshLambertMaterial({color:oc[o-1]}));mesh.position.set(x,h+1,z);scene.add(mesh)}}addEventListener("resize",()=>{cam.aspect=innerWidth/innerHeight;cam.updateProjectionMatrix();renderer.setSize(innerWidth,innerHeight)});let cooldown=0;renderer.setAnimationLoop(()=>{if(renderer.xr.isPresenting){let s=renderer.xr.getSession();if(s)for(let src of s.inputSources){let gp=src.gamepad;if(!gp)continue;let ax=gp.axes,hand=src.handedness;if(hand==="right"){let dx=ax[2]||0,dy=ax[3]||0;if(Math.abs(dx)+Math.abs(dy)>.1){let dir=new T.Vector3();cam.getWorldDirection(dir);dir.y=0;dir.normalize();let right=new T.Vector3().crossVectors(dir,new T.Vector3(0,1,0));rig.position.add(dir.multiplyScalar(-dy*speed));rig.position.add(right.multiplyScalar(dx*speed))}}else if(hand==="left"){let lx=ax[2]??ax[0]??0;if(cooldown<=0){if(lx>0.8){rig.rotation.y-=snap;cooldown=15}else if(lx<-0.8){rig.rotation.y+=snap;cooldown=15}}}}if(cooldown>0)--cooldown;let gx=Math.floor(rig.position.x+.5),gz=Math.floor(rig.position.z+.5);if(gx>=0&&gx<S&&gz>=0&&gz<S)rig.position.y=hmap[gz][gx]}renderer.render(scene,cam)});</script></body></html>