
<html><head><meta charset="utf-8"><title>WFC WebXR</title><style>body{margin:0;overflow:hidden;background:#000}</style></head><body><script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.161.0/three.min.js"></script><script>const VRButton={createButton:function(r){const e=document.createElement("button");function t(n){e.style.display=n?"none":""}function i(n){n?e.setAttribute("disabled",""):e.removeAttribute("disabled")}function o(){navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor"]}).then(n=>{r.xr.setSession(n),e.textContent="EXIT VR",n.addEventListener("end",u)}).catch(c)}function u(){e.textContent="ENTER VR"}function c(n){console.warn("VRButton:",n)}if("xr"in navigator){e.style.cssText="position:absolute;bottom:20px;left:20px;padding:12px 18px;font:700 13px sans-serif;background:#fff;border:none;border-radius:4px;cursor:pointer;z-index:999",t(!0),navigator.xr.isSessionSupported("immersive-vr").then(n=>{n?(t(!1),e.textContent="ENTER VR",e.onclick=o):i(!0)});return e}else{const n=document.createElement("a");return n.href="https://immersiveweb.dev/",n.innerHTML="WEBXR NOT AVAILABLE",n.style.cssText="position:absolute;bottom:20px;left:20px;padding:12px 18px;font:700 13px sans-serif;background:#fff;border:none;border-radius:4px;color:#000;text-decoration:none;z-index:999",n}}};</script><script>(()=>{const SIZE=40,HEIGHT_STATES=7,OBJ_STATES=5,colors=[0xff3e3e,0x3eff3e,0x3e3eff,0xffff3e,0xff3eff,0x3effff,0xffffff];function wfc(s,t){const o=Array.from({length:s},()=>Array.from({length:s},()=>Array.from({length:t},(_,i)=>i))),nbr=(x,y)=>[[x-1,y],[x+1,y],[x,y-1],[x,y+1]].filter(([a,b])=>a>=0&&a<s&&b>=0&&b<s);for(;;){let m=t+1,opts=[];for(let y=0;y<s;y++)for(let x=0;x<s;x++){const c=o[y][x];c.length>1&&(c.length<m?(m=c.length,opts=[[x,y]]):c.length===m&&opts.push([x,y]))}if(!opts.length)break;const[r,u]=opts[Math.random()*opts.length|0],cell=o[u][r],pick=cell[Math.random()*cell.length|0];o[u][r]=[pick];const stack=[[r,u]];while(stack.length){const[a,b]=stack.pop(),v=o[b][a][0];for(const[d,f]of nbr(a,b)){const n=o[f][d];if(n.length>1){const len=n.length;o[f][d]=n.filter(z=>z!==v);if(!o[f][d].length)return null;o[f][d].length<len&&stack.push([d,f])}}}}return o.map(r=>r.map(c=>c[0]))}let heightMap,objMap;do{heightMap=wfc(SIZE,HEIGHT_STATES)}while(!heightMap);do{objMap=wfc(SIZE,OBJ_STATES)}while(!objMap);const scene=new THREE.Scene(),renderer=new THREE.WebGLRenderer({antialias:1});renderer.setSize(innerWidth,innerHeight);renderer.xr.enabled=!0;document.body.appendChild(renderer.domElement);document.body.appendChild(VRButton.createButton(renderer));const player=new THREE.Group();scene.add(player);const camera=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,.1,1e3);player.add(camera);player.position.set(SIZE*.5,5,SIZE*.5);const light=new THREE.DirectionalLight(16777215,1);light.position.set(1,2,3);scene.add(light);const baseBox=new THREE.BoxGeometry(1,1,1),boxGeo=new THREE.BoxGeometry(.5,.5,.5),sphereGeo=new THREE.SphereGeometry(.25,16,12),coneGeo=new THREE.ConeGeometry(.25,.5,16),cylGeo=new THREE.CylinderGeometry(.25,.25,.5,16);for(let z=0;z<SIZE;z++)for(let x=0;x<SIZE;x++){const h=heightMap[z][x],mat=new THREE.MeshLambertMaterial({color:colors[h]}),cube=new THREE.Mesh(baseBox,mat);cube.scale.y=.5+h;cube.position.set(x,cube.scale.y*.5,z);scene.add(cube);const o=objMap[z][x];if(o){let geo,clr;switch(o){case 1:geo=boxGeo,clr=0x999999;break;case 2:geo=sphereGeo,clr=0xffaa00;break;case 3:geo=coneGeo,clr=0x00aaff;break;case 4:geo=cylGeo,clr=0xaa00ff;break;}if(geo){const m=new THREE.Mesh(geo,new THREE.MeshLambertMaterial({color:clr}));m.position.set(x,cube.scale.y+.25,z);scene.add(m)}}}addEventListener("resize",()=>{camera.aspect=innerWidth/innerHeight,camera.updateProjectionMatrix(),renderer.setSize(innerWidth,innerHeight)});let prev=performance.now();renderer.setAnimationLoop(()=>{const now=performance.now(),dt=(now-prev)/1e3;prev=now;step(dt);renderer.render(scene,camera)});function step(dt){const ses=renderer.xr.getSession();if(!ses)return;for(const src of ses.inputSources){if(!src.gamepad)continue;const gp=src.gamepad,ax=gp.axes;if(src.handedness==="right"){const x=ax[2]??ax[0]||0,y=ax[3]??ax[1]||0;if(Math.hypot(x,y)>.1){const speed=2*dt,fw=new THREE.Vector3();camera.getWorldDirection(fw);fw.y=0;fw.normalize();const rt=new THREE.Vector3().crossVectors(fw,new THREE.Vector3(0,1,0));player.position.addScaledVector(fw,-y*speed);player.position.addScaledVector(rt,x*speed)}}else if(src.handedness==="left"){const x=ax[2]??ax[0]||0;if(!src._snap&&x>.6){player.rotation.y-=Math.PI/4;src._snap=!0}else if(!src._snap&&x<-.6){player.rotation.y+=Math.PI/4;src._snap=!0}else if(Math.abs(x)<.4)src._snap=!1}}const gx=Math.floor(player.position.x+.5),gz=Math.floor(player.position.z+.5);let ground=.5;if(gx>=0&&gx<SIZE&&gz>=0&&gz<SIZE)ground=.5+heightMap[gz][gx];player.position.y=ground+1.6}})();</script></body></html>
