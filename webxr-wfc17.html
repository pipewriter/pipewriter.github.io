<!DOCTYPE html><html><head><meta charset="utf-8"><title>WFC XR</title><style>body{margin:0;overflow:hidden}</style></head><body><script type="module">import*as THREE from'https://unpkg.com/three@0.157.0/build/three.module.js';import{VRButton}from'https://unpkg.com/three@0.157.0/examples/jsm/webxr/VRButton.js';const scene=new THREE.Scene(),renderer=new THREE.WebGLRenderer({antialias:!0});renderer.setSize(innerWidth,innerHeight);renderer.xr.enabled=!0;document.body.appendChild(renderer.domElement);document.body.appendChild(VRButton.createButton(renderer));const camera=new THREE.PerspectiveCamera(70,innerWidth/innerHeight,.1,1e3),rig=new THREE.Group();rig.add(camera);scene.add(rig);const light=new THREE.DirectionalLight(16777215,1);light.position.set(1,1,1);scene.add(light);const gridSize=20,tileSize=2,heightLevels=[0,2,4,6],heightColors=[0x2e8b57,0x228b22,0x556b2f,0xffffff],objProtos=[null,new THREE.Mesh(new THREE.BoxGeometry(1,1,1),new THREE.MeshStandardMaterial({color:0xff0000})),new THREE.Mesh(new THREE.SphereGeometry(.6,16,16),new THREE.MeshStandardMaterial({color:0x0000ff})),new THREE.Mesh(new THREE.ConeGeometry(.6,1.2,8),new THREE.MeshStandardMaterial({color:0xffff00}))],heights=[],objects=[];for(let y=0;y<gridSize;y++){heights[y]=[];objects[y]=[];for(let x=0;x<gridSize;x++)heights[y][x]=[0,1,2,3],objects[y][x]=[0,1,2,3]}function nbs(x,y){return[[x+1,y],[x-1,y],[x,y+1],[x,y-1]].filter(p=>p[0]>=0&&p[0]<gridSize&&p[1]>=0&&p[1]<gridSize)}function collapseLayer(layer,allow){let unresolved=!0,guard=0;for(;unresolved&&guard<gridSize*gridSize*10;){guard++;let min=99,cells=[];for(let y=0;y<gridSize;y++)for(let x=0;x<gridSize;x++){const l=layer[y][x].length;l>1&&l<min?(min=l,cells=[[x,y]]):l===min&&cells.push([x,y])}if(99===min){unresolved=!1;break}const[cx,cy]=cells[Math.random()*cells.length|0],opts=layer[cy][cx],pick=opts[Math.random()*opts.length|0];layer[cy][cx]=[pick];const q=[[cx,cy]];for(;q.length;){const[qx,qy]=q.shift(),t=layer[qy][qx][0];for(const[nx,ny]of nbs(qx,qy)){let poss=layer[ny][nx];if(poss.length>1){poss=poss.filter(v=>allow(t,v));poss.length||(poss=[Math.random()*layer[ny][nx].length|0]);poss.length!==layer[ny][nx].length&&(layer[ny][nx]=poss,q.push([nx,ny]))}}}}}collapseLayer(heights,(a,b)=>Math.abs(a-b)<=1);collapseLayer(objects,()=>!0);const gGeo=new THREE.PlaneGeometry(tileSize,tileSize);gGeo.rotateX(-Math.PI/2);for(let y=0;y<gridSize;y++)for(let x=0;x<gridSize;x++){const hIdx=heights[y][x][0],h=heightLevels[hIdx],mat=new THREE.MeshStandardMaterial({color:heightColors[hIdx],flatShading:!0}),g=new THREE.Mesh(gGeo,mat);g.position.set((x-gridSize/2)*tileSize,h,(y-gridSize/2)*tileSize);scene.add(g);const oIdx=objects[y][x][0];if(oIdx){const obj=objProtos[oIdx].clone();obj.position.set(g.position.x,h+1,g.position.z);scene.add(obj)}}const raycaster=new THREE.Raycaster,down=new THREE.Vector3(0,-1,0),eyeHeight=1.6;let lastSnap=0;function gp(hand){for(const s of renderer.xr.getSession().inputSources)if(s.gamepad&&s.handedness===hand)return s.gamepad;return null}renderer.setAnimationLoop(t=>{const r=gp('right'),l=gp('left');if(r){const ax=r.axes[2]??r.axes[0],ay=r.axes[3]??r.axes[1],spd=.05,dir=new THREE.Vector3;camera.getWorldDirection(dir);dir.y=0;dir.normalize();const side=new THREE.Vector3().copy(dir).cross(new THREE.Vector3(0,1,0));rig.position.add(dir.multiplyScalar(-ay*spd));rig.position.add(side.multiplyScalar(ax*spd))}if(l){const lx=l.axes[2]??l.axes[0];Math.abs(lx)>.6&&t-lastSnap>300&&(rig.rotation.y-=Math.sign(lx)*Math.PI/6,lastSnap=t);Math.abs(lx)<.2&&(lastSnap=0)}raycaster.set(new THREE.Vector3(rig.position.x,100,rig.position.z),down);const hits=raycaster.intersectObjects(scene.children,!1);hits.length&&(rig.position.y=hits[0].point.y+eyeHeight);renderer.render(scene,camera)})</script></body></html>