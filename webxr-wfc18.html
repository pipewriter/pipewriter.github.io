
<!DOCTYPE html><html><head><meta charset="utf-8"><title>WFC XR</title><style>body{margin:0;overflow:hidden}</style></head><body><script type="module">import*as THREE from'https://unpkg.com/three@0.157.0/build/three.module.js';import{VRButton}from'https://unpkg.com/three@0.157.0/examples/jsm/webxr/VRButton.js';const scene=new THREE.Scene(),renderer=new THREE.WebGLRenderer({antialias:!0});renderer.setSize(innerWidth,innerHeight);renderer.xr.enabled=!0;document.body.appendChild(renderer.domElement);document.body.appendChild(VRButton.createButton(renderer));const camera=new THREE.PerspectiveCamera(70,innerWidth/innerHeight,.1,1e3),player=new THREE.Group();player.add(camera);scene.add(player);const light=new THREE.DirectionalLight(16777215,1);light.position.set(1,1,1);scene.add(light);const S=1.5,G=50,HN=7,ON=5,hColors=[16711680,65280,255,16776960,16711935,65535,16777215];function wfc(c){const p=[];for(let y=0;y<G;y++){p[y]=[];for(let x=0;x<G;x++)p[y][x]=Array.from({length:c},(_,i)=>i)}const n=(x,y)=>[[x+1,y],[x-1,y],[x,y+1],[x,y-1]].filter(d=>d[0]>=0&&d[0]<G&&d[1]>=0&&d[1]<G),a=t=>[t,(t+1)%c,(t+c-1)%c];let u=!0,g=0;for(;u&&g<G*G*10;){g++;let m=c+1,chs=[];for(let y=0;y<G;y++)for(let x=0;x<G;x++){const l=p[y][x].length;l>1&&l<m?(m=l,chs=[[x,y]]):l===m&&chs.push([x,y])}if(m===c+1){u=!1;break}const[dX,dY]=chs[Math.random()*chs.length|0],opt=p[dY][dX],pick=opt[Math.random()*opt.length|0];p[dY][dX]=[pick];const q=[[dX,dY]];for(;q.length;){const[qx,qy]=q.shift(),t=p[qy][qx][0];for(const[sx,sy]of n(qx,qy)){let arr=p[sy][sx];if(arr.length>1){arr=arr.filter(v=>a(t).includes(v));arr.length||(arr=[Math.random()*c|0]);arr.length!==p[sy][sx].length&&(p[sy][sx]=arr,q.push([sx,sy]))}}}}return p}const hMap=wfc(HN),oMap=wfc(ON),oShapes=[null,new THREE.Mesh(new THREE.BoxGeometry(.7*S,.7*S,.7*S),new THREE.MeshStandardMaterial({color:8947848})),new THREE.Mesh(new THREE.SphereGeometry(.35*S,16,16),new THREE.MeshStandardMaterial({color:8947967})),new THREE.Mesh(new THREE.ConeGeometry(.35*S,.7*S,16),new THREE.MeshStandardMaterial({color:9007104})),new THREE.Mesh(new THREE.CylinderGeometry(.35*S,.35*S,.7*S,16),new THREE.MeshStandardMaterial({color:16744448}))];for(let y=0;y<G;y++)for(let x=0;x<G;x++){const hI=hMap[y][x][0],h=(.3+.4*hI)*S,tile=new THREE.Mesh(new THREE.BoxGeometry(S,h,S),new THREE.MeshStandardMaterial({color:hColors[hI]}));tile.geometry.translate(0,h/2,0);tile.position.set((x-G/2)*S,0,(y-G/2)*S);scene.add(tile);const oI=oMap[y][x][0];if(oI){const obj=oShapes[oI].clone();obj.position.set(tile.position.x,h+.35*S,tile.position.z);scene.add(obj)}}const speed=.07,offset=1.6;let snap=!0;function groundY(x,z){const gx=Math.round(x/S+G/2),gz=Math.round(z/S+G/2);if(gx<0||gx>=G||gz<0||gz>=G)return 0;const hi=hMap[gz][gx][0];return(.3+.4*hi)*S}renderer.setAnimationLoop(()=>{const ses=renderer.xr.getSession();if(ses)ses.inputSources.forEach(src=>{if(!src.gamepad)return;const a=src.gamepad.axes;if(src.handedness==='right'&&a.length>=4){const mx=a[2],my=a[3],dir=new THREE.Vector3;camera.getWorldDirection(dir);dir.y=0;dir.normalize();const right=new THREE.Vector3().crossVectors(dir,new THREE.Vector3(0,1,0)).normalize();player.position.addScaledVector(dir,-my*speed);player.position.addScaledVector(right,mx*speed)}if(src.handedness==='left'&&a.length>=2){const lx=a[0];Math.abs(lx)>.8&&snap?(player.rotation.y+=(lx>0?-1:1)*Math.PI/4,snap=!1):Math.abs(lx)<.2&&(snap=!0)}});player.position.y=groundY(player.position.x,player.position.z)+offset;renderer.render(scene,camera)});</script></body></html>
