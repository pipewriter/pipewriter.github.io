<html><head><meta charset="utf-8"><title>WFC WebXR</title><style>body{margin:0;overflow:hidden}</style></head><body><script src="https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.min.js"></script><script src="https://cdn.jsdelivr.net/npm/three@0.161.0/examples/js/VRButton.js"></script><script>(()=>{const S=30,HT=5,OT=6,HC=[0x4d9f0c,0x6fcb25,0x9dd866,0xc2e8a2,0xeaf7d4],OC=[0,0xff3e3e,0x3eff3e,0x3e3eff,0xffff3e,0xff3eff];function W(a,b){const n=(x,y)=>[[x-1,y],[x+1,y],[x,y-1],[x,y+1]].filter(([i,j])=>i>=0&&i<a&&j>=0&&j<a);let g=Array.from({length:a},()=>Array.from({length:a},()=>Array.from({length:b},(_,i)=>i)));for(;;){let m=b+1,c=[];for(let y=0;y<a;y++)for(let x=0;x<a;x++){let p=g[y][x];p.length>1&&p.length<m?(m=p.length,c=[[x,y]]):p.length===m&&c.push([x,y])}if(!c.length)break;let[r,u]=c[Math.random()*c.length|0],o=g[u][r],e=o[Math.random()*o.length|0];g[u][r]=[e];let q=[[r,u]];for(;q.length;){let[k,l]=q.pop(),v=g[l][k][0];for(let[d,f]of n(k,l)){let w=g[f][d];if(w.length>1){let len=w.length;g[f][d]=w.filter(z=>z!==v);if(!g[f][d].length)return W(a,b);g[f][d].length<len&&q.push([d,f])}}}}return g.map(r=>r.map(c=>c[0]))}const H=W(S,HT),O=W(S,OT),scene=new THREE.Scene(),renderer=new THREE.WebGLRenderer({antialias:true});renderer.setPixelRatio(devicePixelRatio);renderer.setSize(innerWidth,innerHeight);renderer.xr.enabled=true;document.body.appendChild(renderer.domElement);document.body.appendChild(THREE.VRButton.createButton(renderer));const rig=new THREE.Group(),camera=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,.1,1000);camera.position.set(0,1.6,0);rig.add(camera);scene.add(rig);scene.add(new THREE.HemisphereLight(0xffffff,0x444444,1));const ground=new THREE.Group();scene.add(ground);const G={box:new THREE.BoxGeometry(1,1,1),sBox:new THREE.BoxGeometry(.5,.5,.5),sphere:new THREE.SphereGeometry(.3,16,16),cyl:new THREE.CylinderGeometry(.3,.3,.5,16),cone:new THREE.ConeGeometry(.35,.5,16),torus:new THREE.TorusGeometry(.3,.1,8,16)};for(let z=0;z<S;z++)for(let x=0;x<S;x++){let h=1+H[z][x],g=G.box.clone();g.scale(1,h,1);g.translate(0,h/2,0);let m=new THREE.Mesh(g,new THREE.MeshStandardMaterial({color:HC[H[z][x]]}));m.position.set(x,0,z);ground.add(m);let o=O[z][x];if(o){let mat=new THREE.MeshStandardMaterial({color:OC[o]}),mesh;o===1?mesh=new THREE.Mesh(G.sBox,mat):o===2?mesh=new THREE.Mesh(G.sphere,mat):o===3?mesh=new THREE.Mesh(G.cyl,mat):o===4?mesh=new THREE.Mesh(G.cone,mat):o===5&&(mesh=new THREE.Mesh(G.torus,mat));mesh&&(mesh.position.set(x,h+.25,z),ground.add(mesh))}}const ctl=[renderer.xr.getController(0),renderer.xr.getController(1)];ctl.forEach(c=>rig.add(c));let last=0,turnCD=0;addEventListener("resize",()=>{camera.aspect=innerWidth/innerHeight,camera.updateProjectionMatrix(),renderer.setSize(innerWidth,innerHeight)});renderer.setAnimationLoop(t=>{const dt=(t-last)/1000;last=t;const mv=6*dt,turn=30*Math.PI/180;if(renderer.xr.isPresenting){let L=ctl[0].gamepad,R=ctl[1].gamepad;if(L&&L.axes.length>2){let ax=L.axes[2];Math.abs(ax)>.6&&turnCD<=0&&(rig.rotation.y-=Math.sign(ax)*turn,turnCD=.3);turnCD-=dt}if(R&&R.axes.length>3){let mx=R.axes[2],mz=R.axes[3],v=new THREE.Vector3(mx,0,mz);v.lengthSq()>.0001&&(v.normalize(),v.applyAxisAngle(new THREE.Vector3(0,1,0),rig.rotation.y),rig.position.addScaledVector(v,mv))}}let gx=Math.round(rig.position.x),gz=Math.round(rig.position.z);gx>=0&&gx<S&&gz>=0&&gz<S&&(rig.position.y=1+H[gz][gx]);renderer.render(scene,camera)})})();</script></body></html>